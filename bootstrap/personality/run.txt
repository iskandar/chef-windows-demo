Start-Transcript -Path C:\cloud-automation\run.log -Append

$Hostname = $env:COMPUTERNAME
$PublicIP = ((Get-NetIPConfiguration).IPv4Address | Where-Object {$_.InterfaceAlias -eq "public0"}).IpAddress
@{
    "CallbackURLs" = @(
        "{{ node_callback_url }}"
    )
} | ConvertTo-Json | Out-File c:\cloud-automation\config.json

# Fetch a bootstrap script
$BootURL = "https://raw.githubusercontent.com/iskandar/chef-windows-demo/experimental/bootstrap/experimental/bootstrap.ps1"
$BootFile = "C:\cloud-automation\bootstrap.ps1"
(New-Object System.Net.WebClient).DownloadFile($BootURL, $BootFile)

Invoke-Expression -Command $BootFile

Stop-Transcript